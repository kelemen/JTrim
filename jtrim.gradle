//
// This file is to be applied to each JTrim projects.
//

apply plugin: 'java';
apply plugin: 'maven';
apply from: rootProject.file('jtrim-version.gradle');

ext.scriptFile = { String fileName ->
    return new File(new File(rootDir, 'common-scripts'), fileName);
}

if (hasProperty('doRelease') || hasProperty('doCheckStyle')) {
    apply plugin: 'checkstyle';
    checkstyle.configFile = rootProject.file('jtrim-style.xml');

    checkstyleTest.ignoreFailures = true;
    checkstyleTest.showViolations = false;
    checkstyleTest.includes = [];
    checkstyleTest.excludes = [];

    task(configCheckStylyClassPath) doLast {
        checkstyleMain.classpath = project.files(configurations.runtime.resolve());
    }
    checkstyleMain.dependsOn(configCheckStylyClassPath);
}

if (!hasProperty('codeCoverage')) ext.codeCoverage = '';
if (codeCoverage == null) codeCoverage = '';
codeCoverage = codeCoverage.toString().trim();

if (!codeCoverage.isEmpty()) {
    apply from: scriptFile(codeCoverage + '.gradle');
}

apply from: scriptFile('release.gradle');

sourceCompatibility = '1.7';

def compilerOptions = [compileJava, compileTestJava]*.options;
compilerOptions*.encoding = 'UTF-8';
compilerOptions*.compilerArgs = ['-Xlint'];

String mavenGroupId = group;
String mavenArtifactId = name;
String mavenVersion = version;

task sourcesJar(type: Jar, dependsOn: classes, description: 'Creates a jar from the source files.') {
    classifier = 'sources';
    from sourceSets.main.allSource;
}

artifacts {
    archives jar
    archives sourcesJar
}

afterEvaluate {
    System.setProperty('line.separator', '\n');
}

configure(install.repositories.mavenInstaller) {
    pom.project {
        groupId = mavenGroupId;
        artifactId = mavenArtifactId;
        version = mavenVersion;
    }
}

repositories {
    mavenLocal();
    mavenCentral();
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.10';
    testCompile group: 'org.mockito', name: 'mockito-core', version: '1.9.0';
}
